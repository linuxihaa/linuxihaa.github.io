{"pageProps":{"page":{"slug":"2016-08-12_lvm","layout":"post","jdate":"Fri Aug 12 2016 00:00:00 GMT+0000","user":"rmasoumvand","title":"راه‌اندازی LVM در لینوکس","categories":["آموزشی"],"tags":["پیکربندی"],"featured":"linux-lvm.jpg","keywords":["lvm","lvm در لینوکس","linux lvm"],"description":"آموزش راه‌اندازی lvm در لینوکس","timeToRead":5,"content":"\nLVM مخفف Logical Volume Manager روشی پیشرفته برای مدیریت پارتیشن‌ها و فضای دیسک سخت در لینوکس است که امکانات بسیار گسترده‌تری را نسبت به مدل پارتیشن‌بندی سنتی در اختیار مدیر سیستم می‌گذارد.\n\nدر LVM می‌توانیم مجموعه‌ای از دیسک‌های سخت و یا پارتیشن‌ها را که Physical Volume نامیده می‌شوند به‌صورت یک یا چندین دیسک منطقی بزرگ‌تر و یکپارچه با نام Volume Group به وجود بیاوریم و سپس روی این دیسک ایجاد شده پارتیشن‌های خود که در اینجا Logical Volume نامیده می‌شود ایجاد کنیم.\n\nاز جمله مزایای این روش این است زمانی که فضای یکی از پارتیشن‌ها رو به اتمام است به‌راحتی می‌توانیم به‌صورت آنلاین و داینامیک فضای بیشتری را به آن تخصیص بدهیم.\n\nمتأسفانه LVM قابلیت تحمل خطاپذیری و بازیابی داده‌ها را همانند آنچه در RAID ها داریم، ندارد و در صورت خرابی یکی از دیسک‌ها داده‌هایمان از بین خواهد رفت.\n\nدر این آموزش به نحوه نصب و پیکربندی LVM در لینوکس خواهیم پرداخت.\n\nابتدا می‌بایست بسته lvm2 را روی سیستم نصب کنیم.\n\nبرای سیستم‌های مبتنی بر دبیان:\n\n```sh\nsudo apt install lvm2\n```\n\nبرای سیستم‌های مبتنی بر ردهت:\n\n```sh\nsudo yum install lvm2\n```\n\nسپس می‌بایست توسط دستور pvcreate پارتیشن یا دیسک‌های مورد نظرمان را به Physical Volume تبدیل کنیم.\n\n```sh\npvcreate /dev/sda /dev/sdb\n```\n\nپس از اجرای دستور فوق می‌توانیم برای آگاهی از وضعیت Physical Volume ها از دستور زیر استفاده کنیم.\n\n```sh\npvdisplay\n```\n\nکه خروجی آن برای مثال ما بصورت زیر خواهد بود.\n\n```\n  \"/dev/sda\" is a new physical volume of \"8.00 GiB\"\n  --- NEW Physical volume ---\n  PV Name               /dev/sda\n  VG Name               \n  PV Size               8.00 GiB\n  Allocatable           NO\n  PE Size               0   \n  Total PE              0\n  Free PE               0\n  Allocated PE          0\n  PV UUID               cAwfbX-Nik0-X1iR-lAzP-GJGD-5FNS-tX5fuY\n   \n  \"/dev/sdb\" is a new physical volume of \"8.00 GiB\"\n  --- NEW Physical volume ---\n  PV Name               /dev/sdb\n  VG Name               \n  PV Size               8.00 GiB\n  Allocatable           NO\n  PE Size               0   \n  Total PE              0\n  Free PE               0\n  Allocated PE          0\n  PV UUID               VRDlaw-eeXm-p3XP-2w4t-fCZ8-92NP-2izZb3\n```\n\nهمانطور که مشاهده می‌کنید دیسک‌های sda و sdb هر کدام با حجم 8 گیگ تعریف شده‌اند.\n\nحال می‌بایست برای Physical Volume های ایجاد شده یک Volume Group تعریف کنیم.\n\n```sh\nvgcreate vg_server /dev/sda /dev/sdb\n```\n\nکه در اینجا یک Volume Group با نام vg_server ایجاد نمودیم و دو دیسک sda و sdb را به آن اضافه کردیم. برای بررسی وضعیت Volume Group ایجاد شده دستور زیر را وارد می‌کنیم.\n\n```sh\nvgdisplay vg_server\n```\n\nکه خروجی آن بصورت زیر خواهد بود.\n\n```\n  --- Volume group ---\n  VG Name               vg_server\n  System ID             \n  Format                lvm2\n  Metadata Areas        2\n  Metadata Sequence No  1\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                0\n  Open LV               0\n  Max PV                0\n  Cur PV                2\n  Act PV                2\n  VG Size               15.99 GiB\n  PE Size               4.00 MiB\n  Total PE              4094\n  Alloc PE / Size       0 / 0   \n  Free  PE / Size       4094 / 15.99 GiB\n  VG UUID               udnHV5-QwGw-PkA4-zsF3-5ABo-WhOA-XI51SZ\n```\nهمان‌طور که مشاهده می‌کنید در بخش Free PE/ Size مجموع فضای دیسک‌ها اضافه شده را نمایش می دهد.\n\nبرای اضافه نمودن دیسک‌های بیشتر به Volume Group می‌توانیم به صورت زیر عمل کنیم.\n\n```sh\npvcreate /dev/sdd\nvgextend vg_server /dev/sdd\n```\n\nکه در اینجا ما یک Physical Volume به نام sdd را به Volume Group اضافه نمودیم.\n\nسپس می‌توانیم به‌صورت زیر Logical Volume های مورد نظرمان را روی Volume Group ایجاد شده تعریف کنیم.\n\n```sh\nlvcreate -L 1G -n Vol01 vg_server\n```\n\nکه در اینجا ما یک Logical Volume با حجم 1Gb  و نام Vol01 تعریف نمودیم.\n\nجهت مشاهده وضعیت Logical Volume ایجاد شده دستور زیر را وارد می‌کنیم.\n\n```sh\nlvdisplay vg_server\n```\n\nکه خروجی آن بصورت زیر خواهد بود.\n\n```\n  --- Logical volume ---\n  LV Path                /dev/vg_server/Vol01\n  LV Name                Vol01\n  VG Name                vg_server\n  LV UUID                dwdyI0-yy7l-jF9U-bPHB-QNpO-15RO-0uKlPH\n  LV Write Access        read/write\n  LV Creation host, time debian, 2016-08-11 11:48:48 -0400\n  LV Status              available\n  # open                 0\n  LV Size                1.00 GiB\n  Current LE             256\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           253:0\n```\n\nسپس می‌توانیم Logical Volume ایجاد شده را با فرمت فایل سیستم مورد نظرمان به‌صورت زیر فرمت کنیم.\n\n```sh\nmkfs -t ext4 /dev/vg_server/vol01\n```\n\nو در نهایت توسط دستور mount انرا ماونت کنیم.\n\n```sh\nmount /dev/vg_server/vol01 /mnt\n```\n\nدر صورتی که بخواهیم اندازه Logical Volume مورد نظرمان را تغییر دهیم می‌توانیم به‌صورت زیر عمل کنیم.\n\n```sh\nlvextend -L +800 /dev/vg_server/vol01\n```\n\nو سپس توسط دستور زیر جهت اعمال تغییرات روی فایل سیستم Logical Volume وارد می‌کنیم.\n\n```sh\nresize2fs /dev/vg_server/vol01\n```\n\nدر مثال فوق 800Mb از فضای خالی Volume Group به Logical Volume اضافه نمودیم.\n\nبرای حذف Logical Volume می‌توانیم به‌صورت زیر عمل کنیم.\n\n```sh\nlvremove /dev/vg_server/vol01\n```\n\nو برای حذف Volume Group دستور زیر را وارد می‌کنیم.\n\n```sh\nvgremove vg_server\n```\n"}},"__N_SSG":true}