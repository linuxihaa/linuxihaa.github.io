<!DOCTYPE html><html lang="fa"><head><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" href="/icon-512x512.png"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link href="//db.onlinewebfonts.com/c/14b4bf4df4455e6a1277f2b2584dadd6?family=BBCNassim" rel="stylesheet" type="text/css"/><meta name="msapplication-TileColor" content="#ce1919"/><meta name="theme-color" content="#ce1919"/><meta charSet="utf-8"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@handle"/><meta property="og:type" content="website"/><meta property="og:locale" content="fa_IR"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>visudo، ویرایش sudoers</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="آموزش ویرایش sudoers با visudo"/><meta property="og:url" content="/articles/[slug]"/><meta property="og:title" content="visudo، ویرایش sudoers"/><meta property="og:description" content="آموزش ویرایش sudoers با visudo"/><meta property="og:image" content="https://linuxiha.com/images/sudo_report_incident.png"/><meta property="og:image:alt" content="visudo، ویرایش sudoers"/><meta property="og:image:width" content="800"/><meta property="og:image:height" content="600"/><meta property="og:site_name" content="Linuxiha"/><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://linuxiha.com/articles/2015-03-23_visudo"
    },
    "headline": "visudo، ویرایش sudoers",
    "image": [
      "https://linuxiha.com/images/sudo_report_incident.png"
     ],
    "datePublished": "Mon Mar 23 2015 00:00:00 GMT+0000",
    "dateModified": "Mon Mar 23 2015 00:00:00 GMT+0000",
    "author": {"@type": "Person","name": "میثم ساکی"},
    "publisher": {
      "@type": "Organization",
      "name": "Linuxiha",
      "logo": {
        "@type": "ImageObject",
        "url": "https://linuxiha.com/images/logo.png"
      }
    },
    "description": "آموزش ویرایش sudoers با visudo"
  }</script><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https://linuxiha.com",
          "name": "لینوکسی ها"
        }
      },{
        "@type": "ListItem",
        "position": 2,
        "item": {
          "@id": "/learning",
          "name": "آموزشی"
        }
      },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https://linuxiha.com/articles/2015-03-23_visudo",
          "name": "visudo، ویرایش sudoers"
        }
      }
     ]
  }</script><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/css/be235685d546691402be.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be235685d546691402be.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d4b1ad855d90d489a111.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d4b1ad855d90d489a111.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" as="script"/><link rel="preload" href="/_next/static/chunks/dccdaae97238514e0e59f68ff40a3150f2d60869.fd7c33e9ae3c66b740c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-3c19994afb449613f52a.js" as="script"/><link rel="preload" href="/_next/static/chunks/c18007ee4e366b206423f37b43f40d4861448257.6ad75590f65d0a64ea61.js" as="script"/><link rel="preload" href="/_next/static/chunks/9f32a1895f4aacf1ea63ff9f71a540b7eb71f721.c3d97f18e04e41235ad9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-5e768503c47f0f474cf1.js" as="script"/><link rel="preload" href="/_next/static/chunks/884c0b09aaba7d8da8976f96bae68463b81d3e33.69e17f26dc467dcd1735.js" as="script"/><link rel="preload" href="/_next/static/chunks/755b54d753eea6c310ec0b9a05508d467366a08f.dd8ff6ba50741b700375.js" as="script"/><link rel="preload" href="/_next/static/chunks/6b20a07b2d70cfcb2a9bc7e0210d4109f26bcd0c.6ef66b02a65441044c74.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/articles/%5Bslug%5D-8dd97a7322e8b3511971.js" as="script"/></head><body dir="rtl" lang="fa"><div id="__next"><header class="header_container__2boq4"><h2></h2><nav class="header_navbar__3Tbm7"><a href="/">خانه</a><a href="/news">خبری</a><a href="/learning">آموزشی</a><a href="/about">درباره ما</a></nav><figure class="header_logo__ZHkcG"><img src="/images/logo.png" alt="linuxiha-logo"/></figure></header><div class="MuiPaper-root article_article__15ETi MuiPaper-elevation1 MuiPaper-rounded"><img src="/images/sudo_report_incident.png" alt="visudo، ویرایش sudoers"/><h1>visudo، ویرایش sudoers</h1><div class="MuiCardHeader-root"><div class="MuiCardHeader-avatar"><div class="MuiAvatar-root MuiAvatar-circle article_avatar__2QXuX" aria-label="article"><img alt="میثم ساکی" src="authors/user.png" class="MuiAvatar-img"/></div></div><div class="MuiCardHeader-content"><span class="MuiTypography-root MuiCardHeader-title MuiTypography-body2 MuiTypography-displayBlock">میثم ساکی</span><span class="MuiTypography-root MuiCardHeader-subheader MuiTypography-body2 MuiTypography-colorTextSecondary MuiTypography-displayBlock">۶ سال قبل - زمان خواندن ۵ دقیقه</span></div></div><section class="article_content__1mHP3"><p>سلام. قبل از شروع این مطلب، سال جدید رو به شما تبریک می‌گم و امیدوارم سال ۱۳۹۴ همراه با سلامتی و موفقیت برای شما و خانوادتون باشه.</p>
<p><img src="/images/sudo_report_incident.png" alt="یه عکس که بی‌ربط نیست به موضوع مطلبمون و سال نو!"/></p>
<p>یه عکس که بی‌ربط نیست به موضوع مطلبمون و سال نو!</p>
<p>تو این پست قصد دارم نحوه‌ی ویرایش فایل sudoers با visudo رو آموزش بدم. توی مطلب «<a href="http://linuxihaa.ir/sudo/">sudo چیست؟</a>» دیدید که sudo برای اجرای دستوراتی استفاده میشه که ما اجازه اجرای اون‌ها رو نداریم؛ مثل دستور apt-get در دبیان و اوبونتو که برای اجرا نیاز به دسترسی روت داره و ما می‌تونیم با دستور sudo apt-get و دادن پسورد خودمون اون رو اجرا کنیم.</p>
<p>یکم جلوتر بریم و توی پست «<a href="http://linuxihaa.ir/%D8%A7%D8%AC%D8%B1%D8%A7%DB%8C-%D8%AF%D8%B3%D8%AA%D9%88%D8%B1-%D8%B3%D9%88%D8%AF%D9%88-%D8%A8%D8%AF%D9%88%D9%86-%D9%BE%D8%B3%D9%88%D8%B1%D8%AF/">اجرای دستور سودو بدون پسورد</a>» دیدید که ما نیاز داشتیم بعضی از دستورات رو بدون نیاز به دادن پسورد اجرا کنیم. مثلا sudo apt-get رو که وارد کردیم دیگه نیاز به وارد کردن پسورد نباشه و بدون دریافت پسورد اجرا بشه. توی اون پست یه روش مبتدیانه و خطرناک گفتم اما قول دادم که روش اصولی رو آموزش بدم که حالا به قولم وفا کردم!</p>
<p>خب شروع کنیم. می‌خوایم یه کارایی کنیم که بعضی دستورات با sudo که اجرا میشن دیگه نیاز نباشه که پسوردمون رو وارد کنیم. این کار و خیلی کارهای دیگه رو میشه از طریق ویرایش فایل sudoers انجام داد. کلیت کارها، اعطای دسترسی اجرا دستور (یا دستورات یا فایل) برای کاربری (یا گروه کاربران) در هر ماشین (یا یک ماشین خاص)، بدون نیاز به وارد کردن پسورد‌ (یا نیاز به وارد کردن پسورد) هست. حالا میتونه شامل اعطای اجرای تمام دستورات (حتی دستورات با دسترسی روت) برای کاربران ادمین سیستم با نیاز به وارد کردن پسورد باشه که میشه همون استفاده همیشگی که از دستور sudo داریم؛ یا اینکه اجرای یک دستور (که ما دسترسی به اجرای اون رو نداریم و مثلا فقط با دسترسی روت میتونه اجرا بشه) برای کاربری خاص بدون نیاز به وارد کردن پسورد.</p>
<p>حالا که می‌دونیم با ویرایش sudoers چه کارهایی میشه انجام داد بیایم یه توضیحی درباره اون بدیم. فایل sudoers معمولا توی شاخه <!-- -->&lt;span dir=&quot;ltr&quot;&gt;<!-- -->/etc<!-- -->&lt;/span&gt;<!-- --> هست و یک فایل متنی با ساختار مشخص هست که پیکربندی sudo محسوب میشه و دستور sudo با توجه به محتوای این فایل دسترسی‌ها رو تست و اعمال می‌کنه. برای ویرایش این فایل می‌تونید مستقیم فایل رو پیدا کنید و با هر ویرایشگری که خواستید ویرایش کنید یا اینکه از دستور visduo استفاده کنید که به معنی باز کردن فایل sudoers با ویرایشگر vi هست و این فایل رو با ویرایشگر پیش‌فرض شما برای ویرایش باز میکنه.</p>
<p>بریم سراغ ویرایش فایل sudoers.</p>
<p>ساختار این فایل از دو نوع دستور ایجاد شده. مورد اول برای مشخص کردن تنظیمات پیش‌فرض هست؛ مثل اینکه با وارد کردن پسورد چه زمانی طول بکشه تا دوباره این نشست منقضی بشه و دوباره نیاز به وارد کردن پسورد باشه یا ویرایشگر پیشفرض visudo چی باشه و ... . اما مورد دوم همین دسترسی‌ها هست که دربارش صحبت کردیم.</p>
<p>واسه اینکه هم مثالی برای مورد اول بشه و هم اینکه در تست‌های بعدی راحت باشیم این خط رو به فایل sudoers اضافه کنید.</p>
<pre><code></code></pre>
<p>این خط می‌گه که زمان انقضای پسورد 0 باشه؛ یعنی برای هر بار استفاده از دستور sudo نیاز به دادن پسورد باشه (اگه نیاز بود). به صورت پیشفرض این زمان معمولا 15 دقیقه هست؛ یعنی اینکه با اجرای دستوری مثل sudo apt-get و دادن پسورد، تا 15 دقیقه دیگه نیاز به وارد کردن پسورد نیست (در همین نشست) و اگه دستور sudo apt-get رو تو این بازه زمانی اجرا کنیم بدون نیاز به دادن پسورد اجرا میشه.</p>
<ul>
<li>
<p>این تنظیم برای ادامه آموزش نیاز هست تا کار شما راحت‌تر باشه و اگر این مورد رو فعال نکردید باید بعد از هر بار که پسورد رو وارد کردید دستور sudo -K رو وارد کنید تا زمان منقضی بشه و برای اجرای دوباره sudo نیاز به دادن پسورد باشه. این کار رو انجام می‌دیم که تفاوت تنظیماتی که در ادامه انجام می‌دیم رو با حالت عادی احساس کنید.</p>
</li>
<li>
<p>اگر این تنظیم رو انجام دادید بعد از تست این مطلب اون رو حذف کنید.</p>
</li>
<li>
<p>توجه: در دستورات ترمینالی که استفاده شده، نوشته‌ها با رنگ زرد، خروجی هستند.</p>
</li>
</ul>
<p>و مورد دوم. فرض کنید من فایلی به نام test.sh با محتوای <!-- -->&lt;span dir=&quot;ltr&quot;&gt;<!-- -->echo &#x27;Linuxihaa&#x27;<!-- -->&lt;/span&gt;<!-- --> می‌سازم و دسترسی اون رو 700 قرار می‌دم.</p>
<pre><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-sh" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ echo &quot;echo &#x27;Linuxihaa&#x27;&quot; &gt; test.sh
</span>$ chmod 700 test.sh
</code></pre></pre>
<p>حالا اگه فایل رو اجرا کنید متن خروجی رو مشاهده می‌کنید.</p>
<pre><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-sh" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ ./test.sh
</span>Linuxihaa
</code></pre></pre>
<p>بیاید مالک فایل رو روت قرار بدید تا دیگه بهش دسترسی نداشته باشید.</p>
<pre><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-sh" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ sudo chown root test.sh</span></code></pre></pre>
<p>حالا دوباره فایل رو اجرا کنید تا مشاهده کنید که قادر به اجرای اون نیستید.</p>
<pre><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-sh" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ ./test.sh
</span>-bash: ./test.sh: Permission denied
</code></pre></pre>
<p>می‌دونیم که با اجرای دستور sudo ./test.sh و دادن پسورد این فایل اجرا میشه اما برای اینکه پسورد نخواد خط زیر رو به فایل sudoers اضافه کنید. توجه کنید که بجای YOUR_USERNAME، نام کاربری خودتون و بجای FILE_PATH آدرس فایل test.sh رو به صورت کامل بنویسید.</p>
<pre><code></code></pre>
<p>بعد از اضافه کردن این خط به فایل sudoers اگه دستور sudo ./test.sh رو وارد کنید می‌بینید که بدون نیاز به دادن پسورد، دستور اجرا میشه.</p>
<p>خب این مثال تموم شد اما بیایم ببنیم ساختار کلی اعطای مجوز در فایل sudoers چطور هست؟</p>
<p>ساختار هر خط تقریبا به شکل زیر هست.</p>
<pre><code></code></pre>
<ul>
<li>در بخش اول می‌تونید یک نام کاربری یا گروه کاربری (برای گروه کاربری باید اول نام گروه کاراکتر % قرار بدید) بنویسید.</li>
<li>در بخش دوم<!-- -->
<ul>
<li>ابتدا نام ماشینی که مجوز در اون اعطا میشه رو وارد می‌کنید (می‌تونید نام ماشین خودتون رو بنویسید) و یا ALL می‌نویسید تا برای همه ماشین‌ها باشه.</li>
<li>سپس نام یوزی که میشه با اون اجرا بشه رو وارد می‌کنید یا ALL می‌نویسید تا محدودیتی نباشه. این مورد برای دستور sudo -u USERNAME استفاده میشه.</li>
</ul>
</li>
<li>در بخش سوم یا می‌نویسید <!-- -->&lt;span dir=&quot;ltr&quot;&gt;<!-- -->NOPASSWD:<!-- -->&lt;/span&gt;<!-- --> تا نیاز به وارد کردن پسورد نباشه یا چیزی نمی‌نویسید تا پسورد نیاز باشه.</li>
<li>در بخش چهارم مسیر فایل دستور یا فایل‌های خودتون رو وارد می‌کنید. میتونه یه فایل خاص باشه یا فایل‌های داخل یه شاخه خاص. همچنین می‌تونید بعد از نام فایل، آرگومان‌های مشخصی رو هم بنویسید تا اون دستور فقط با اون آرگومان‌ها قابل دسترس باشه.</li>
</ul>
<ul>
<li>
<p>اگه چند آرگومان با نام مشابه هست می‌تویند از * استفاده کنید. مثلا <!-- -->&lt;span dir=&quot;ltr&quot;&gt;<!-- -->up*<!-- -->&lt;/span&gt;<!-- --> آرگومان‌های update و upgrade رو شامل میشه.</p>
</li>
<li>
<p>می‌تونید چندتا مسیر رو با دادن , از هم جدا کنید و مجوز به همشون اعمال بشه.</p>
</li>
</ul>
<p>نکته دیگری هست خوشحال میشم شما بگید یا بپرسید تا جواب داده بشه.</p>
<p>موفق باشید.</p>
<ul>
<li>تصویر شاخص از 4.bp.blogspot.com</li>
</ul></section><div class="progress_root__2VpcX"><div class="MuiLinearProgress-root MuiLinearProgress-colorPrimary MuiLinearProgress-determinate" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div class="MuiLinearProgress-bar MuiLinearProgress-barColorPrimary MuiLinearProgress-bar1Determinate" style="transform:translateX(100%)"></div></div></div></div><nav id="navbar" class="menu_menu-container__3W1os"><a class="menu_menu-item__2FGZV" href="/"><img src="/icons/home.png" alt="home"/> <span>خانه</span> <aside></aside></a><a class="menu_menu-item__2FGZV" href="/news"><img src="/icons/news.png" alt="news"/> <span>خبری</span> <aside></aside></a><a class="menu_menu-item__2FGZV" href="/learning"><img src="/icons/article.png" alt="article"/> <span>آموزشی</span> <aside></aside></a><a class="menu_menu-item__2FGZV" href="/about"><img src="/icons/info.png" alt="info"/> <span>درباره ما</span> <aside></aside></a></nav></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"page":{"slug":"2015-03-23_visudo","layout":"post","jdate":"Mon Mar 23 2015 00:00:00 GMT+0000","user":"misam","title":"visudo، ویرایش sudoers","categories":["آموزشی"],"tags":["sudo"],"featured":"sudo_report_incident.png","keywords":["visudo","sudoers","ویرایش sudoers"],"description":"آموزش ویرایش sudoers با visudo","timeToRead":5,"content":"\nسلام. قبل از شروع این مطلب، سال جدید رو به شما تبریک می‌گم و امیدوارم سال ۱۳۹۴ همراه با سلامتی و موفقیت برای شما و خانوادتون باشه.\n\n![یه عکس که بی‌ربط نیست به موضوع مطلبمون و سال نو!](/images/sudo_report_incident.png)\n\nیه عکس که بی‌ربط نیست به موضوع مطلبمون و سال نو!\n\nتو این پست قصد دارم نحوه‌ی ویرایش فایل sudoers با visudo رو آموزش بدم. توی مطلب «[sudo چیست؟](http://linuxihaa.ir/sudo/)» دیدید که sudo برای اجرای دستوراتی استفاده میشه که ما اجازه اجرای اون‌ها رو نداریم؛ مثل دستور apt-get در دبیان و اوبونتو که برای اجرا نیاز به دسترسی روت داره و ما می‌تونیم با دستور sudo apt-get و دادن پسورد خودمون اون رو اجرا کنیم.\n\nیکم جلوتر بریم و توی پست «[اجرای دستور سودو بدون پسورد](http://linuxihaa.ir/%D8%A7%D8%AC%D8%B1%D8%A7%DB%8C-%D8%AF%D8%B3%D8%AA%D9%88%D8%B1-%D8%B3%D9%88%D8%AF%D9%88-%D8%A8%D8%AF%D9%88%D9%86-%D9%BE%D8%B3%D9%88%D8%B1%D8%AF/)» دیدید که ما نیاز داشتیم بعضی از دستورات رو بدون نیاز به دادن پسورد اجرا کنیم. مثلا sudo apt-get رو که وارد کردیم دیگه نیاز به وارد کردن پسورد نباشه و بدون دریافت پسورد اجرا بشه. توی اون پست یه روش مبتدیانه و خطرناک گفتم اما قول دادم که روش اصولی رو آموزش بدم که حالا به قولم وفا کردم!\n\nخب شروع کنیم. می‌خوایم یه کارایی کنیم که بعضی دستورات با sudo که اجرا میشن دیگه نیاز نباشه که پسوردمون رو وارد کنیم. این کار و خیلی کارهای دیگه رو میشه از طریق ویرایش فایل sudoers انجام داد. کلیت کارها، اعطای دسترسی اجرا دستور (یا دستورات یا فایل) برای کاربری (یا گروه کاربران) در هر ماشین (یا یک ماشین خاص)، بدون نیاز به وارد کردن پسورد‌ (یا نیاز به وارد کردن پسورد) هست. حالا میتونه شامل اعطای اجرای تمام دستورات (حتی دستورات با دسترسی روت) برای کاربران ادمین سیستم با نیاز به وارد کردن پسورد باشه که میشه همون استفاده همیشگی که از دستور sudo داریم؛ یا اینکه اجرای یک دستور (که ما دسترسی به اجرای اون رو نداریم و مثلا فقط با دسترسی روت میتونه اجرا بشه) برای کاربری خاص بدون نیاز به وارد کردن پسورد.\n\nحالا که می‌دونیم با ویرایش sudoers چه کارهایی میشه انجام داد بیایم یه توضیحی درباره اون بدیم. فایل sudoers معمولا توی شاخه \u003cspan dir=\"ltr\"\u003e/etc\u003c/span\u003e هست و یک فایل متنی با ساختار مشخص هست که پیکربندی sudo محسوب میشه و دستور sudo با توجه به محتوای این فایل دسترسی‌ها رو تست و اعمال می‌کنه. برای ویرایش این فایل می‌تونید مستقیم فایل رو پیدا کنید و با هر ویرایشگری که خواستید ویرایش کنید یا اینکه از دستور visduo استفاده کنید که به معنی باز کردن فایل sudoers با ویرایشگر vi هست و این فایل رو با ویرایشگر پیش‌فرض شما برای ویرایش باز میکنه.\n\nبریم سراغ ویرایش فایل sudoers.\n\nساختار این فایل از دو نوع دستور ایجاد شده. مورد اول برای مشخص کردن تنظیمات پیش‌فرض هست؛ مثل اینکه با وارد کردن پسورد چه زمانی طول بکشه تا دوباره این نشست منقضی بشه و دوباره نیاز به وارد کردن پسورد باشه یا ویرایشگر پیشفرض visudo چی باشه و ... . اما مورد دوم همین دسترسی‌ها هست که دربارش صحبت کردیم.\n\nواسه اینکه هم مثالی برای مورد اول بشه و هم اینکه در تست‌های بعدی راحت باشیم این خط رو به فایل sudoers اضافه کنید.\n\n```\nDefaults:ALL timestamp_timeout=0\n```\n\nاین خط می‌گه که زمان انقضای پسورد 0 باشه؛ یعنی برای هر بار استفاده از دستور sudo نیاز به دادن پسورد باشه (اگه نیاز بود). به صورت پیشفرض این زمان معمولا 15 دقیقه هست؛ یعنی اینکه با اجرای دستوری مثل sudo apt-get و دادن پسورد، تا 15 دقیقه دیگه نیاز به وارد کردن پسورد نیست (در همین نشست) و اگه دستور sudo apt-get رو تو این بازه زمانی اجرا کنیم بدون نیاز به دادن پسورد اجرا میشه.\n\n* این تنظیم برای ادامه آموزش نیاز هست تا کار شما راحت‌تر باشه و اگر این مورد رو فعال نکردید باید بعد از هر بار که پسورد رو وارد کردید دستور sudo -K رو وارد کنید تا زمان منقضی بشه و برای اجرای دوباره sudo نیاز به دادن پسورد باشه. این کار رو انجام می‌دیم که تفاوت تنظیماتی که در ادامه انجام می‌دیم رو با حالت عادی احساس کنید.\n\n* اگر این تنظیم رو انجام دادید بعد از تست این مطلب اون رو حذف کنید.\n\n* توجه: در دستورات ترمینالی که استفاده شده، نوشته‌ها با رنگ زرد، خروجی هستند.\n\nو مورد دوم. فرض کنید من فایلی به نام test.sh با محتوای \u003cspan dir=\"ltr\"\u003eecho 'Linuxihaa'\u003c/span\u003e می‌سازم و دسترسی اون رو 700 قرار می‌دم.\n\n```sh\n$ echo \"echo 'Linuxihaa'\" \u003e test.sh\n$ chmod 700 test.sh\n```\n\nحالا اگه فایل رو اجرا کنید متن خروجی رو مشاهده می‌کنید.\n\n```sh\n$ ./test.sh\nLinuxihaa\n```\n\nبیاید مالک فایل رو روت قرار بدید تا دیگه بهش دسترسی نداشته باشید.\n\n```sh\n$ sudo chown root test.sh\n```\n\nحالا دوباره فایل رو اجرا کنید تا مشاهده کنید که قادر به اجرای اون نیستید.\n\n```sh\n$ ./test.sh\n-bash: ./test.sh: Permission denied\n```\n\nمی‌دونیم که با اجرای دستور sudo ./test.sh و دادن پسورد این فایل اجرا میشه اما برای اینکه پسورد نخواد خط زیر رو به فایل sudoers اضافه کنید. توجه کنید که بجای YOUR_USERNAME، نام کاربری خودتون و بجای FILE_PATH آدرس فایل test.sh رو به صورت کامل بنویسید.\n\n```\nYOUR_USERNAME ALL=(ALL) NOPASSWD: FILE_PATH\n```\n\nبعد از اضافه کردن این خط به فایل sudoers اگه دستور sudo ./test.sh رو وارد کنید می‌بینید که بدون نیاز به دادن پسورد، دستور اجرا میشه.\n\nخب این مثال تموم شد اما بیایم ببنیم ساختار کلی اعطای مجوز در فایل sudoers چطور هست؟\n\nساختار هر خط تقریبا به شکل زیر هست.\n\n```\n[USERNAME / %GROUPNAME] [MACHINE]=(USER) \u003cNOPASSWD:\u003e [PATH] [ARGUMENTS]\n```\n\n*   در بخش اول می‌تونید یک نام کاربری یا گروه کاربری (برای گروه کاربری باید اول نام گروه کاراکتر % قرار بدید) بنویسید.\n*   در بخش دوم\n    *   ابتدا نام ماشینی که مجوز در اون اعطا میشه رو وارد می‌کنید (می‌تونید نام ماشین خودتون رو بنویسید) و یا ALL می‌نویسید تا برای همه ماشین‌ها باشه.\n    *   سپس نام یوزی که میشه با اون اجرا بشه رو وارد می‌کنید یا ALL می‌نویسید تا محدودیتی نباشه. این مورد برای دستور sudo -u USERNAME استفاده میشه.\n*   در بخش سوم یا می‌نویسید \u003cspan dir=\"ltr\"\u003eNOPASSWD:\u003c/span\u003e تا نیاز به وارد کردن پسورد نباشه یا چیزی نمی‌نویسید تا پسورد نیاز باشه.\n*   در بخش چهارم مسیر فایل دستور یا فایل‌های خودتون رو وارد می‌کنید. میتونه یه فایل خاص باشه یا فایل‌های داخل یه شاخه خاص. همچنین می‌تونید بعد از نام فایل، آرگومان‌های مشخصی رو هم بنویسید تا اون دستور فقط با اون آرگومان‌ها قابل دسترس باشه.\n\n- اگه چند آرگومان با نام مشابه هست می‌تویند از * استفاده کنید. مثلا \u003cspan dir=\"ltr\"\u003eup*\u003c/span\u003e آرگومان‌های update و upgrade رو شامل میشه.\n\n- می‌تونید چندتا مسیر رو با دادن , از هم جدا کنید و مجوز به همشون اعمال بشه.\n\nنکته دیگری هست خوشحال میشم شما بگید یا بپرسید تا جواب داده بشه.\n\nموفق باشید.\n\n* تصویر شاخص از 4.bp.blogspot.com"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"2015-03-23_visudo"},"buildId":"igqXl2OPJ05s2tPs4MQMK","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-e893e522365b6e0e5fa4.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" async=""></script><script src="/_next/static/chunks/dccdaae97238514e0e59f68ff40a3150f2d60869.fd7c33e9ae3c66b740c3.js" async=""></script><script src="/_next/static/chunks/main-3c19994afb449613f52a.js" async=""></script><script src="/_next/static/chunks/c18007ee4e366b206423f37b43f40d4861448257.6ad75590f65d0a64ea61.js" async=""></script><script src="/_next/static/chunks/9f32a1895f4aacf1ea63ff9f71a540b7eb71f721.c3d97f18e04e41235ad9.js" async=""></script><script src="/_next/static/chunks/pages/_app-5e768503c47f0f474cf1.js" async=""></script><script src="/_next/static/chunks/884c0b09aaba7d8da8976f96bae68463b81d3e33.69e17f26dc467dcd1735.js" async=""></script><script src="/_next/static/chunks/755b54d753eea6c310ec0b9a05508d467366a08f.dd8ff6ba50741b700375.js" async=""></script><script src="/_next/static/chunks/6b20a07b2d70cfcb2a9bc7e0210d4109f26bcd0c.6ef66b02a65441044c74.js" async=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-8dd97a7322e8b3511971.js" async=""></script><script src="/_next/static/igqXl2OPJ05s2tPs4MQMK/_buildManifest.js" async=""></script><script src="/_next/static/igqXl2OPJ05s2tPs4MQMK/_ssgManifest.js" async=""></script></body></html>